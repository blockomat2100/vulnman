from apps.api.v2 import generics
from apps.api import authentication
from apps.api.v2.serializers import vulnerability as serializers
from apps.findings import models


class VulnerabilityViewSet(generics.SearchModelViewSet):
    search_fields = ["name", "template__vulnerability_id"]
    serializer_class = serializers.VulnerabilitySerializer
    authentication_classes = [authentication.ProjectTokenAuthentication]

    def get_queryset(self):
        return models.Vulnerability.objects.filter(
            project=self.request.auth.project)

    def perform_create(self, serializer):
        serializer.save(
            creator=self.request.user,
            project=self.request.auth.project)
