\chapter{Vulnerabilities}

{%- if project.has_vulns_with_severity('Critical') or project.has_vulns_with_severity('High') -%}
In the course of the investigation, vulnerabilities were found that, among other things, pose a high risk of
have been identified.
The listed recommendations for action should be implemented as soon as possible.

{% elif project.has_vulns_with_severity('Medium') %}
TODO Only medium vulns found
{% elif project.has_vulns_with_severity('Low') %}
TODO Only low severity vulns found
{%- else %}
We were unable to identify any weaknesses during the investigation.
{%- endif -%}

The following vulnerabilities are grouped by system.

\clearpage

{%- for host in project.host_set.all() -%}
\section{ {{- host.ip -}} }
\label{ss:host-{{- host.ip -}} }

\textbf{Hostname(s)}:  {{ host.get_hostnames() }}   \\
{%- if host.os -%}
\textbf{OS}: {{ host.os }}    \\
{%- endif -%}

{%- for vuln in host.vulnerability_set.all() -%}
\subsection{ \textcolor{ {{- vuln.get_severities()[0] -}} }{ {{- vuln.name -}} } }
\label{ ss:vuln-{{- vuln.pk -}} }

\begin{table}[h]
  \renewcommand{\arraystretch}{1.5}
    \centering
    \begin{tabular}{| l | p{12cm} |}
        \hline
        \multirow{2}{*}{CVSS} & {{- vuln.get_scores()[0] }} ({{- vuln.get_severities()[0] -}})   \\
        \cline{2-2}
        & {{- vuln.cvss_vector -}}  \\
        \hline
        \multirow{ {{-vuln.reference_set.all()|length -}} }{*}{References}
         {%- for reference in vuln.reference_set.all() -%}
         {%- if loop.index == 1 -%}
         & {{ reference }} \\
         {%- if loop.last -%}
         \hline
         {%- endif -%}
         {%- elif loop.last -%}
         \cline{2-2}
         & {{ reference }} \\
         \hline
         {%- else %}
         \cline{2-2}
         & {{ reference }} \\
         {%- endif -%}
         {%- endfor %}
    \end{tabular}
\end{table}

\subsubsection{Description}
{{- vuln.description|md_to_tex|latex_escape -}}
\subsubsection{Resolution}
{{- vuln.resolution|md_to_tex|latex_escape -}}
{%- if vuln.proofofconcept_set.count() -%}
\subsubsection{Proof Of Concept}
{%- for proof in vuln.proofofconcept_set.all() -%}
    {%- if proof.image -%}
        \begin{figure}[h]
            \centering
            \includegraphics[scale=0.5]{ {{- proof.image.path -}} }
            \caption{ {{- proof.name -}} }
        \end{figure}
    {%- endif -%}
{%- endfor -%}
{%- endif -%}

\clearpage
{%- endfor -%}


{%- endfor -%}