{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}Create Vulnerability{% endblock %}


{% block extra_head %}
    <link href="{% static 'css/vendor/select2/select2.min.css' %}" rel="stylesheet"/>
    <link href="{% static 'css/vulnman/components/select2.css' %}" rel="stylesheet"/>
    <script src="{% static 'js/vendor/select2/select2.min.js' %}"></script>
{% endblock extra_head %}


{% block content %}
    <div class="container mt-3">
        {% include 'forms/formset.html' with title="Vulnerability" %}
    </div>
{% endblock %}


{% block extra_scripts %}

    <script>
        $('#id_template_id').select2({
            theme: 'bootstrap-5',
            ajax: {
                url: '{% url 'api:v1:vulnerability-template-list' %}',
                dataType: 'json',
                data: function (params) {
                    // Query parameters will be ?search=[term]&type=public
                    return {search: params.term};
                },
                processResults: function (data) {
                    return {
                        results: jQuery.map(data.results, function (item) {
                            return {
                                id: item.vulnerability_id,
                                text: item.name
                            }
                        })
                    };
                },
            },
            placeholder: 'Template',
            minimumInputLength: 1,
        });
    </script>
{% endblock %}