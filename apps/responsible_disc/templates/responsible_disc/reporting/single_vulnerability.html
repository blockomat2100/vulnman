{% load markdown %}
{% load vulns %}

<!-- Header Table -->
<section id="vuln-{{ vulnerability.pk }}-header">
    <h3 id="vuln-{{ vulnerability.pk }}-title">
                <span class="fa-layers text-{{ vulnerability.get_severity_display|lower }}">
                    <i class="fas fa-bookmark"></i>
                    <span class="fa-layers-text" data-fa-transform="shrink-8 down-3" style="font-weight:900"></span>
                </span>
        {{ vulnerability.template.name }} - {{ vulnerability.name }}
    </h3>

    <table style="width: 100%" id="intro-detail-table">
        <thead>
            <tr>
                <th>Severity</th>
                <th>Category</th>
                <th>Discovery</th>
                <th>CVE-ID</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td class="text-{{ vulnerability.get_severity_display|lower }}">{{ vulnerability.get_severity_display|capfirst }}</td>
                <td>{{ vulnerability.template.category }}</td>
                <td>{{ vulnerability.date_created|date }}</td>
                {% if vulnerability.cve_id %}
                <td>{{ vulnerability.cve_id }}</td>
                {% else %}
                <td>-</td>
                {% endif %}
                <td>{{ vulnerability.get_status_display }}</td>
            </tr>
        </tbody>
    </table>

    <table style="margin-top: 30px;">
        <tr>
            <th style="padding-right: 65px">Affected Product</th>
            <td>{{ vulnerability.vendor }} {{ vulnerability.affected_product }}</td>
        </tr>
        <tr>
           <th>Affected Versions</th>
           <td>{{ vulnerability.affected_versions }}</td>
        </tr>
        <tr>
            <th>Researcher</th>
            <td>{{ vulnerability.user.username }}</td>
        </tr>
    </table>
</section>

<section id="proofs-{{ vulnerability.pk }}">
    <h4>Technical Details</h4>
    {% for proof in vulnerability.proofs %}
        {% if proof.description %}
            {{ proof.description|md_to_html }}
            {% if proof.image %}
                <figure>
                    <img src="{{ proof.base64_encoded_image }}" alt="proof-image"
                         style="width: 100%; max-width: 100%; height:auto;">
                    {% if proof.caption %}
                        <figcaption>{{ proof.caption }}</figcaption>
                    {% endif %}
                </figure>
            {% endif %}
        {% endif %}
        {% if proof.text %}
            {{ proof.text|md_to_html }}
        {% endif %}
    {% endfor %}
</section>